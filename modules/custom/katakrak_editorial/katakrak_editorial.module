<?php
/**
 * @file
 * Code for the Katakrak Editorial feature.
 */

include_once 'katakrak_editorial.features.inc';

/**
 * 
 * @param type $nodes
 * @param type $types
 */
function katakrak_editorial_node_load($nodes, $types) {
  global $language;
  if (count(array_intersect(array('libro_ed'), $types))) {
    foreach($nodes as $node) {
      $traductores = '';
      foreach($node->field_libro_ed_traductor['und'] as $i => $trad_nid) {
				$traductor = node_load($trad_nid['nid']);
				$traductores .= l($traductor->title, 'node/'.$traductor->nid);
				if (count($node->field_libro_ed_traductor['und']) > $i+1)
					$traductores .= ', ';
			}
      $node->traductores = $traductores;
			
			foreach($node->field_libro_ed_autor['und'] as $i => $aut_nid) {
				$autor = node_load($aut_nid['nid']);
        $trad = translation_node_get_translations($autor->tnid);
        $autor_trad = node_load($trad[$node->language]->nid);
        $node->autores[] = $autor_trad;
			}

      $resenas = array();
      if ($node->field_libro_ed_resenas) {
        foreach ($node->field_libro_ed_resenas['und'] as $res_nid) {
          $resena = node_load($res_nid['nid']);
          if ($resena->field_cita){
            $res_temp = new stdClass();
            $res_temp->nid = $resena->nid;
            $res_temp->cita = $resena->field_cita['und'][0]['value'];
            $res_temp->fuente = $resena->field_fuente_cita['und'][0]['value'];
            $resenas[] = $res_temp;
            dpm($res_temp);
          }
        }
      }
      $node->resenas = $resenas;
    }
  }
}