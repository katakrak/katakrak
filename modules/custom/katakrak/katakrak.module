<?php
/**
 * @file
 * Code for the Katakrak feature.
 */

include_once 'katakrak.features.inc';

function katakrak_admin_paths() {
  $paths = array(
    'node/*/edit' => TRUE,
    'node/*/translate' => TRUE,
    'node/*/devel' => TRUE,
    'node/*/dilve' => TRUE,
    'node/add/*' => TRUE,
  );
  return $paths;
}

/**
 * Implements hook_block_info().
 */
function katakrak_block_info() {
  include_once DRUPAL_ROOT . '/includes/language.inc';
  $block = array();
  $info = language_types_info();
  dpm($info);
  foreach (language_types_configurable(FALSE) as $type) {
    $block[$type] = array(
      'info' => t('Language switcher (@type) small', array('@type' => $info[$type]['name'])),
      // Not worth caching.
      'cache' => DRUPAL_NO_CACHE,
    );
  }
  return $block;
}

/**
 * Implements hook_block_view().
 *
 * Displays a language switcher. Only show if we have at least two languages.
 */
function katakrak_block_view($type) {
  if (drupal_multilingual()) {
    $path = drupal_is_front_page() ? '<front>' : $_GET['q'];
    $links = language_negotiation_get_switch_links($type, $path);
    if (isset($links->links)) {
      drupal_add_css(drupal_get_path('module', 'locale') . '/locale.css');
      
      foreach ($links->links as $id => &$link) {
        $link['title'] = $id;
      }
      $class = "language-switcher-{$links->provider}";
      $variables = array('links' => $links->links, 'attributes' => array('class' => array($class)));
      $block['content'] = theme('links__locale_block', $variables);
      return $block;
    }
  }
}