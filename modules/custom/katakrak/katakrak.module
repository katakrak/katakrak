<?php
/**
 * @file
 * Code for the Katakrak feature.
 */

include_once 'katakrak.features.inc';

function katakrak_admin_paths() {
  $paths = array(
    'node/*/edit' => TRUE,
    'node/*/translate' => TRUE,
    'node/*/devel' => TRUE,
    'node/*/dilve' => TRUE,
    'node/add/*' => TRUE,
  );
  return $paths;
}

/**
 * Implements hook_block_info().
 */
function katakrak_block_info() {
  include_once DRUPAL_ROOT . '/includes/language.inc';
  $blocks = array();
  $blocks['language_switcher'] = array(
    'info' => t('Language switcher small'),
    // Not worth caching.
    'cache' => DRUPAL_NO_CACHE,
  );
  $blocks['newsletter_suscribe'] = array(
    'info' => t('Katakrak suscribe block'),
    // Not worth caching.
    'cache' => DRUPAL_NO_CACHE,
  );
  return $blocks;
}

/**
 * Implements hook_block_view().
 */
function katakrak_block_view($delta) {
  if ($delta == 'language_switcher' && drupal_multilingual()) {
    $path = drupal_is_front_page() ? '<front>' : $_GET['q'];
    $links = language_negotiation_get_switch_links('language', $path);
    if (isset($links->links)) {
      drupal_add_css(drupal_get_path('module', 'locale') . '/locale.css');
      
      foreach ($links->links as $id => &$link) {
        $link['title'] = $id;
      }
      $class = "language-switcher-{$links->provider}";
      $variables = array('links' => $links->links, 'attributes' => array('class' => array($class)));
      $block['content'] = theme('links__locale_block', $variables);
      return $block;
    }
  }
  if ($delta == 'newsletter_suscribe') {
    $block['content'] = drupal_get_form('katakrak_newsletter_suscribe_form');
    return $block;
  }
}

function katakrak_newsletter_suscribe_form($form, &$form_state) {
  $form['mail'] = array(
    '#type' => 'textfield',
    '#title' => t('Mail'),
  );
  $form['submit'] = array(
    '#type' => 'submit',
    '#value' => t('Submit'),
  );
  return $form;
}